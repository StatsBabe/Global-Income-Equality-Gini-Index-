# load devtools
library(devtools)
# load reshape
library(tidyverse)
library(reshape)#
library(plsdepot)
library(plotly)

getwd()

trust<-read.csv("Gini1.0.csv", stringsAsFactors = FALSE, header = TRUE, na.strings=c('NA',''))
str(trust)

head(trust)

names(trust)

pls = trust[ ,c(1:3,4:6,8,9,7)]

pls1 = plsreg1(pls[, 1:8], pls[, 9, drop = FALSE], comps = 3)

pls1

plot(pls1)

# rows of the inner model matrix 
Inequality = c(0, 0, 0) 
Trust = c(0, 0, 0) 
Health = c(1, 1, 0)

# path matrix created by row binding 
Path_Matrix = rbind(Inequality, Trust, Health)
# add column names (optional) 
colnames(Path_Matrix) = rownames(Path_Matrix)
Path_Matrix
# PATH MATRIX
#            Inequality Trust Health
# Inequality          0     0      0
# Trust               0     0      0
# Health              1     1      0

# define list of indicators: what variables are associated with 
# what latent variables 
foot_blocks = list(1:3, 4:6, 7:9)

# Health in formative mode B 
foot_modes = c("A", "A", "B")

#  Data, path matrix, blocks and modes.

# run plspm analysis 
foot_pls = plspm(trust, Path_Matrix, foot_blocks, modes = foot_modes)

innerplot(Path_Matrix)

# pls1$x.scores          X-scores (T-components)
# pls1$x.loads            X-loadings
#                   p1         p2          p3
#Gini     -0.50301691  0.3035350  0.26570355
#Quintile -0.51323856  0.3575847  0.16053403
#Palma    -0.54611992  0.2608996  0.14621635
#Tfam      0.20224143 -0.5288265  0.36673411
#Tneigh   -0.04782841 -0.6527435  0.35071372
#Tper      0.06107393 -0.4762160  0.75918009
#Health   -0.33500465 -0.2441074  0.00932437
#TB       -0.46332893 -0.1458043 -0.42142877

# pls1$y.scores          Y-scores (U-components)
# 
#             u1          u2          u3
#1   3.05665701  2.83423961  1.90292232
#2   2.63353607  1.51428913  0.57195222
#3   2.63353607  2.14566209  1.61988414
#4   1.96359458  2.35317084  0.81182855
#5   2.84509654  2.42564545  3.14709403
#6   3.83237873  2.96473335  1.25813355
#7   2.66879615  1.30906057  1.08530608
#8   3.33873763  3.48902228  3.22720580
#9   1.92833450  0.79858149  0.42381565
#10  1.96359458  1.12364675  0.02223268
#11  1.50521356  2.49023536  1.96842020
#12  3.05665701  4.85158786  2.86690547
#13  0.48267129 -1.90165800 -1.90668353
#14 -0.01096980 -0.73646870 -1.17781626
#15  0.87053215 -1.01374956 -1.43366167
#16  1.68151396  2.30863036  1.77492705
#17 -0.61039113 -2.48242515 -1.72694247
#18  0.44741122  1.98024310  1.23662659
#19  0.94105231  1.01064040  1.33001608
#20  1.18787286  2.24298909  0.79065178
#21  0.87053215  2.95867730  0.58780567
#22  0.90579223  0.95746100  0.60204734
#23 -0.64565121 -2.22378757 -2.59912950
#24 -0.01096980 -0.03155030  1.26467253
#25  0.02429028 -1.95829622 -1.25134280
#26  0.48267129  0.49485324 -1.31889922
#27  0.97631239 -0.71755783 -0.79204005
#28  0.51793137  0.57599628  0.07535135
#29  0.72949184  1.79455558  2.23592222
#30  0.51793137  0.59031411  1.64937243
#31 -0.85721168 -2.29908941 -0.13749741
#32 -0.32831051 -1.51689762 -1.51612682
#33 -1.42137293 -1.98217341 -0.17888352
#34 -1.42137293 -0.80509757 -0.64281363
#35 -5.82888272  2.57883645  2.62952604
#36 -0.43409074 -1.27072733 -0.38543594
#37 -1.45663301 -3.33491167 -1.88858095
#38 -0.25779035 -0.18738122 -0.57651616
#39 -2.23235473 -2.14512939 -0.11293856
#40 -4.77108037 -4.68902590 -4.23179636
#41 -3.04333653 -2.24977515  0.62210609
#42 -8.01500757 -7.90243653 -5.46567861
#43 -3.74853810 -5.11287239 -3.21141642
#44 -3.85431833 -0.08242857 -3.26750345
#45 -3.11385669 -1.14963223  0.11697747
# pls1$y.loads            Y-loadings
#        c1        c2        c3 
# 0.3968871 0.2943312 0.3348017 

# pls1$cor.xyt             score correlations
# t1         t2           t3
# Gini     -0.84227922  0.3888929  0.236504445
# Quintile -0.85939492  0.4581420  0.142892380
# Palma    -0.91445327  0.3342678  0.130148120
# Tfam      0.33864420 -0.6775392  0.326432394
# Tneigh   -0.08008652 -0.8363032  0.312172549
# Tper      0.10226555 -0.6101340  0.675751098
# Health   -0.56095024 -0.3127535  0.008299682
# TB       -0.77582348 -0.1868063 -0.375116465
# LE        0.66456965  0.3771008  0.298009138

#pls1$raw.wgs          raw weights
#w1          w2         w3
#Gini     -0.33839154  0.37916838  0.1377591
#Quintile -0.32881734  0.42476257  0.1223583
#Palma    -0.38698470  0.36652335  0.1923840
#Tfam      0.09146488 -0.25514273  0.4984897
#Tneigh   -0.30481073 -0.59188673  0.1108450
#Tper      0.03994522 -0.04866406  0.7787464
#Health   -0.42797039 -0.21412051  0.0546183
#TB       -0.58445144 -0.27897174 -0.2425522

# pls1$mod.wgs        modified weights
# w*1         w*2        w*3
# Gini     -0.33839154  0.23224729  0.2652689
# Quintile -0.32881734  0.28199836  0.2771827
# Palma    -0.38698470  0.19850433  0.3013680
# Tfam      0.09146488 -0.21543098  0.3802125
# Tneigh   -0.30481073 -0.72422787 -0.2867749
# Tper      0.03994522 -0.03132085  0.7615504
# Health   -0.42797039 -0.39993448 -0.1649561
# TB       -0.58445144 -0.53272585 -0.5350325

#pls1$std.coefs        standard coefficients
#         Gini     Quintile        Palma         Tfam       Tneigh         Tper       Health           TB 
#0.022866859  0.045298786  0.005735279  0.100188984 -0.430150995  0.261603403 -0.342796697 -0.567888844 
 
# pls1$reg.coefs        regular coefficients
#79.66354645   0.01824237   0.06212992   0.03173168   5.19752663 -24.93169184  18.14171608 -22.41905287 
#TB 
#-0.37047068 

# pls1$R2                      R-squared
#         t1         t2         t3 
# 0.44165282 0.14220501 0.08880945 
# pls1$R2Xy                 explained variance of X-y by T
#t1        t2        t3
#Gini     0.709434283 0.8606720 0.9166063
#Quintile 0.738559631 0.9484537 0.9688720
#Palma    0.836224790 0.9479598 0.9648983
#Tfam     0.114679894 0.5737393 0.6802974
#Tneigh   0.006413851 0.7058169 0.8032686
#Tper     0.010458244 0.3827217 0.8393613
#Health   0.314665173 0.4124799 0.4125488
#TB       0.601902078 0.6367987 0.7775110
#LE       0.441652822 0.5838578 0.6726673

# pls1$y.pred                 y-predicted
# pls1$resid                  residuals
# pls$T2                      T2 hotelling
# pls1$Q2                     Q2 cross validation
#      PRESS      RSS          Q2  LimQ2     Q2cum
#1 29.39306 44.00000  0.33197584 0.0975 0.3319758
#2 20.88807 24.56728  0.14976032 0.0975 0.4320194
#3 18.57956 18.31026 -0.01470809 0.0975 0.4236654







